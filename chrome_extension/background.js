var counter=1,tabstack=[],enabled=!1,runScript=!1,lastLine=0,exampleScript="Type 'hi' in to 'Address' input.\nFill out the following fields: \n* Last Name: Horner\n* Phone: 260-459-6270\nClick on the 'Save' button. \nClick 'OK'.\nType 'finally' in 'Slow Input'\nClick on the 'going away' link.\nType 'it worked' in '#lst-ib'";function sendMessage(e,t,n){e?(chrome.tabs.sendMessage(e,t),n&&n()):chrome.tabs.query({active:!0,currentWindow:!0},(function(e){e&&e.length&&(chrome.tabs.sendMessage(e[0].id,t),n&&n())}))}function InjectHerbie(e,t){tabstack.push(e),chrome.tabs.executeScript(e,{file:"dist/jquery.min.js"},(function(){chrome.tabs.executeScript(e,{file:"dist/jquery.simulate.js"},(function(){chrome.tabs.executeScript(e,{file:"dist/bililiteRange.js"},(function(){chrome.tabs.executeScript(e,{file:"dist/jquery.simulate.ext.js"},(function(){chrome.tabs.executeScript(e,{file:"dist/jquery.simulate.drag-n-drop.js"},(function(){chrome.tabs.executeScript(e,{file:"dist/jquery.simulate.key-sequence.js"},(function(){chrome.tabs.executeScript(e,{file:"dist/jquery.simulate.key-combo.js"},(function(){chrome.tabs.executeScript(e,{file:"herbie/inspector.js"},(function(){chrome.tabs.executeScript(e,{file:"herbie/herbie.js"},(function(){chrome.tabs.executeScript(e,{file:"content.js"},(function(){t&&t()}))}))}))}))}))}))}))}))}))}))}console.log("Loaded."),chrome.runtime.onInstalled.addListener((function(){console.log("Installed."),localStorage.counter++})),chrome.browserAction.onClicked.addListener((function(){enabled?(chrome.browserAction.setBadgeText({text:""}),enabled=!1,tabstack.forEach((function(e){chrome.tabs.sendMessage(e,"Stop")}))):(tabstack.forEach((function(e){chrome.tabs.sendMessage(e,"Show")})),chrome.tabs.query({currentWindow:!0},(function(e){e&&e.length&&(enabled=!0,chrome.browserAction.setBadgeText({text:"ON"}),InjectHerbie(e[0].id,(function(){sendMessage(e[0].id,{cmd:"Show",script:exampleScript})})))})))})),chrome.webNavigation.onCommitted.addListener((function(e){if(enabled){if("link"===e.transitionType)InjectHerbie(e.tabId,(function(){runScript&&"forward_back"!==e.transitionQualifiers[0]?sendMessage(e.tabId,{cmd:"Run",script:exampleScript,line:lastLine+1}):sendMessage(e.tabId,{cmd:"Show",script:exampleScript})}));else if("reload"===e.transitionType)InjectHerbie(e.tabId,(function(){sendMessage(e.tabId,{cmd:"Show",script:exampleScript})}));else{var t=tabstack.indexOf(e.tabId);t>=0&&tabstack.splice(t,1)}console.log("onCommitted",e)}})),chrome.runtime.onMessage.addListener((function(e,t,n){if(e.setAlarm)chrome.alarms.create({delayInMinutes:.1});else{if(e.delayedResponse)return setTimeout((function(){n("Got your message.")}),5e3),!0;e.getCounters?n({counter:counter++,persistentCounter:localStorage.counter++}):"update"===e.event?exampleScript=e.script:"starting"===e.event?(runScript=!0,exampleScript=e.script):"done"===e.event?runScript=!1:"progress"===e.event&&(runScript=!0,lastLine=e.details.line)}console.log("onMessage:",e)})),chrome.runtime.onSuspend.addListener((function(){console.log("Suspending.")}));