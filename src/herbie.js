!function(e){var t=null,n=!1;function r(e){if(!e)return[];var t=e.split("\n"),n=[];for(i=0;i<t.length;i++){var r={line:i,code:[],src:t[i],timeout:5e3},c=t[i].match(/\w+|'[^']+'|"[^"]+"|\{\{(.*?)\}\}|\*|:/g);if(c)if("*"!==c[0].charAt(0))for(j=0;j<c.length;j++){var a=c[j].charAt(0);if("{"==a||'"'==a||"'"==a)r.code.push(c[j]);else{var o=c[j].toLowerCase();switch(o){case"click":r.code.push(o),r.code.push("in");break;case"type":case"capture":case"test":case"open":case"wait":case"switch":case"navigate":case"press":case"button":case"close":case"autocomplete":case"ok":case"save":r.code.push(o);break;case"on":case"in":case"into":r.code.length&&"in"==r.code[r.code.length-1]||r.code.push("in")}}}else r.code.push("type"),c=t[i].match(/\*[^:]+|:.+/g),r.code.push(c[1].slice(1).trim()),r.code.push("in"),r.code.push(c[0].slice(1).trim());n.push(r)}return n}function c(){var e,t=arguments[0],i={line:0,delay:100,cmdtree:t},r=[];2==arguments.length?"[object Function]"==Object.prototype.toString.call(arguments[1])?e=arguments[1]:i=arguments[1]:3==arguments.length&&(arguments[1]&&(i=arguments[1]),e=arguments[2]);var a=i.line;if(a>=t.length)e&&e(!0,i,"Finished.");else if(n)e&&e(!0,null,"Stopped.");else{var o=$.inArray("in",t[a].code);if(-1!=o){var s=t[a].code[o+1];if('"'!==s.charAt(0)&&"'"!==s.charAt(0)||(s=s.slice(1,-1)),!(r=function(e){var t,i=0;e.match(":$")?i=1:e+=":";try{if((t=$("label:contains("+e+")")).length)return t=t.first(),$("#"+t.attr("for"))}catch(n){}e=e.slice(0,-1);try{if((t=$("label:contains("+e+")")).length)return t=t.first(),$("#"+t.attr("for"))}catch(n){}i&&(e+=":");try{if((t=$("button:contains("+e+")")).length)return t.first()}catch(n){}try{if((t=$("a:contains("+e+")")).length)return t.first()}catch(n){}try{t=$(e)}catch(r){t=[]}return 1===t.length?t:[]}(s)).length)return t[a].timeout>0?(t[a].timeout-=i.delay,setTimeout((function(){c(t,i,e)}),i.delay)):void(e&&e(!0,i,"Aborting. Cannot find tag named: '"+s+"'"))}switch(e&&e(!1,i),t[a].code[0]){case"press":return'"'!==(h=t[a].code[1]).charAt(0)&&"'"!==h.charAt(0)||(h=h.slice(1,-1)),r.length||(r=$(document.activeElement)),r.simulate("key-combo",{combo:h}),r.next().focus(),setTimeout((function(){i.line++,c(t,i,e)}),i.delay);case"type":var h;return'"'!==(h=t[a].code[1]).charAt(0)&&"'"!==h.charAt(0)||(h=h.slice(1,-1)),void(r.length&&r.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).simulate("key-sequence",{sequence:h,delay:i.delay,callback:function(){i.line++,c(t,i,e)}}));case"click":return r.length&&r.fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100).simulate("click"),setTimeout((function(){i.line++,c(t,i,e)}),i.delay);default:return setTimeout((function(){i.line++,c(t,i,e)}),i.delay)}}}e.Herbie=[],e.Herbie.StopScript=function(){n=!0},e.Herbie.StartScript=function(e,i){i&&(t=i),n=!1;var a="",o=[],s=void 0;e?"object"==typeof e?(o=r(a=e.script),s={line:e.line,delay:100,cmdtree:o}):o=r(a=e):o=r(a=$("#herbie_script").val()),t&&t({event:"starting",script:a,options:e}),$("#herbie_run").text("Stop"),o.length&&c(o,s,(function(e,i,n){var r=$("#herbie_output");r.length?(e&&$("#herbie_run").text("Run"),i&&i.line<i.cmdtree.length?($("#herbie_line").val(i.line+1),r.append("Line: "+(i.line+1)+", Cmd:"+i.cmdtree[i.line].src+"\n")):i&&$("#herbie_line").val(""),n&&r.append("["+n+"]\n"),r.animate({scrollTop:r[0].scrollHeight},10)):console.log(e,i,n),t&&t(e?{event:"done",details:i,comment:n}:{event:"progress",details:i,comment:n})}))},e.Herbie.Stop=function(){Herbie.StopScript(),$(".herbie_div").hide()},e.Herbie.BuildUI=function(e,i,n){if(n&&(t=n),$(".herbie_div").show().length)return i&&$("#herbie_script").text(i),void(t&&t({event:"UIdone"}));$("body").append("<div id='herbie'></div>"),$("#herbie").load(e+"herbie.html",(function(){$(this).contents().unwrap(),$("#herbie_logo").attr("src",e+"../logos/herbie48.png"),i&&$("#herbie_script").text(i),$(".herbie_div").on("mousedown",(function(e){"DIV"==$(e.target).prop("tagName")&&($(this).addClass("herbie_draging").parents().on("mousemove",(function(e){$(".herbie_draging").css("right","auto").offset({top:e.pageY-$(".herbie_draging").outerHeight()/2,left:e.pageX-$(".herbie_draging").outerWidth()/2})})),e.preventDefault())})).on("mouseup",(function(){var e=$(".herbie_draging");e.length&&(e.offset().left<0&&e.offset({left:0}),e.offset().top<0&&e.offset({top:0}),e.removeClass("herbie_draging"),e.css("right","auto"))})),$(".herbie_hide").on("click",(function(){switch($(this).text()){case"Hide":$(this).parent().parent().find("div").hide(),$(this).parent().show(),$(this).parent().parent().css("width","auto"),$(this).parent().parent().css("left","auto"),$(this).parent().parent().css("right","0"),$(this).text("Show");break;case"Small":$(this).parent().next().hide(),$(this).text("Hide");break;case"Show":$(this).parent().parent().find("div").show(),$(this).text("Small")}})),$("#herbie_add").click((function(){var e=$("#herbie_script").val();e.match(/\n$/)||(e+="\n"),e+=$("#herbie_command").val()+"\n",$("#herbie_script").val(e),$("#herbie_command").val("").focus(),t&&t({event:"update",script:e})})),$("#herbie_parse").click((function(){var e=r($("#herbie_script").val());$("#herbie_output").text(JSON.stringify(e,null,2))})),$("#herbie_run").click((function(){switch($(this).text()){case"Run":$("#herbie_output").text(""),Herbie.StartScript({script:$("#herbie_script").val(),line:Math.max(Number($("#herbie_line").val())-1,0)});break;case"Stop":Herbie.StopScript()}})),$("#herbie_inspect").click((function(){$(".herbie_bar").hide(),$(".herbie_script").hide(),$(".herbie_output").show(),document.RunInspector($("#herbie_output"),(function(){$(".herbie_bar").show(),$(".herbie_script").show()}))})),t&&t({event:"UIdone"})}))}}(window);